---
title: 新主机初始化脚本
date: 2020-09-08 10:25:54
tags: 
 - shell
categories: 
 - linux
 - shell
---
# 新主机初始化脚本

## 问题

> 主题频繁更换，有些东西都需要从新安装一遍，费事，还容易忽略



## 脚本内容列表

- **安装nodejs**
- **安装jdk**
- **安装python**
- **安装 autojump**
- **安装 trash-cli**
- **设置vim** **快捷键**
- **开放防火墙端口(安全问题可以不开)**
- **常用命令**
  - **lrzsz**
  - **git**
  - **wget**
  - **zsh**
  - **oh-my-zsh**
- **设置时区**

## 准备工作

> 需要 **shell** 编程的知识

### 执行命令，结果保存到变量

 ```shell
v_node='命令'
v_node=$(${v_node})
 ```

### if 、else 判断

```shell
if [[ "$v_trash" != "" ]]; then
        echo "0"
else
        echo '1'
fi
```

> [[ x ]] ; ：x 两边都需要有**空格**，后边如果跟 `then` ，需要有 ; 

### 定义方法

```shell
function xxx() {
    echo '1'
}

v_node=$(xxx)
```

> 方法可以使用 `return` ，不过 `return` 只能返回 0 - 255 的整数 ，使用 `echo`，`$()` 可以返回任意值




## 脚本

```shell
#/bin/bash
#测试是否安装nodejs
function verify_nodejs() {
    v_node='node -v'
    v_node=$(${v_node})
    if [[ "$v_node" != "" ]]; then
        echo "0"
    else
        echo '1'
    fi
}

#测试是否安装trash-cli
function verify_trash_cli() {
    v_trash='trash-put --version'
    v_trash=$(${v_trash})
    if [[ "$v_trash" != "" ]]; then
        echo "0"
    else
        echo '1'
    fi
}

#测试是否安装autojump
function verify_autojump() {
    v_autojump='j --version'
    v_autojump=$(${v_autojump})
    if [[ "$v_autojump" != "" ]]; then
        echo "0"
    else
        echo '1'
    fi
}

# echo "begin set vim custom key"
# cd /root
# v_vimrc=".vimrc"
# unalias cp > /dev/null 2>&1
# if [ ! -f "$v_vimrc" ]; then
#     touch "$v_vimrc"
# else
#     cp -f "$v_vimrc" .vimrc_bak
# fi
# echo "let mapleader=' '" >> /root/.vimrc
# echo "nnoremap H ^" >> /root/.vimrc

# echo "vim custom key set over"
# echo "please exec source /root/.vimrc"

# echo ">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"

echo "begin install oft linux command(git/lrzsz/wget/lsof/zsh/oh-my-zsh)"
yum install -y git >>/dev/null 2>&1
yum install -y lrzsz >>/dev/null 2>&1
# yum install -y autojump  >> /dev/null 2>&1
yum install -y wget >>/dev/null 2>&1
yum install -y lsof >>/dev/null 2>&1
yum install -y zsh >>/dev/null 2>&1
yum install java-1.8.0-openjdk -y  >>/dev/null 2>&1
wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O - | sh
chsh -s /bin/zsh root
echo "command installed "
echo ">>>>>>>>>>>>>>>>>>>>>>"


echo "begin start install nodejs"
v_node=$(verify_nodejs)
if [[ "$v_node" == "0" ]]; then
    echo "nodejs was alreaded installed"
else
    cd /usr/local
    wget https://nodejs.org/dist/v14.9.0/node-v14.9.0-linux-x64.tar.xz >/dev/null 2>&1
    tar -xvf node-v14.9.0-linux-x64.tar.xz >/dev/null 2>&1
    mv node-v14.9.0-linux-x64 nodejs

    echo 'exprot PATH=$PATH:/usr/local/nodejs' >>/etc/profile_bak
    source /etc/profile

    v_node=$(verify_nodejs)
    if [[ "$v_node" == "0" ]]; then
        echo "node install success, version is  ${v_node}"
    else
        echo "nodejs install fail"
    fi
fi
echo ">>>>>>>>>>>>>>>>>>>>>>"



# echo "begin install set bash color"
# cd /root
# echo 'export PS1="\[\033[1;36m\]\u\[\033[1;32m\][\w]\[\033[1;33m\]->\[\033[0m\]"' >>.bashrc_bak
# source /root/.bashrc
# echo "set bash color complete"
# echo ">>>>>>>>>>>>>>>>>>>>>>"

echo "begin open firewall port(4000,8000-9999,3366,443)"
firewall-cmd --zone=public --add-port=4000/tcp --permanent
#firewall-cmd --zone=public --add-port=8000-9999/tcp --permanent
#firewall-cmd --zone=public --add-port=3306/tcp --permanent
#firewall-cmd --zone=public --add-port=6379/tcp --permanent
firewall-cmd --zone=public --add-port=443/tcp --permanent
echo "open port complete"
echo ">>>>>>>>>>>>>>>>>>>>>>"


echo "begin install trash-cli"
v_trash=$(verify_trash_cli)
if [[ "$v_trash" == 0 ]]; then
    echo "trash-cli already installed"
else
    cd /usr/local
    git clone https://github.com/andreafrancia/trash-cli.git >/dev/null 2>&1
    cd trash-cli
    sudo python setup.py install >/dev/null 2>&1
    echo 'alias rm="Please use <trash-put> command to delete file.";false' >>/root/.zshrc
    source /root/.zshrc
fi
echo "trash-cli install complete"
echo ">>>>>>>>>>>>>>>>>>>>>>"


echo "begin install autojump"
v_autojump=$(verify_autojump)
if [[ "$v_autojump" == 0 ]]; then
    echo "autojump already installed"
else
    cd /usr/local
    git clone git://github.com/joelthelion/autojump.git >/dev/null 2>&1
    cd autojump
    ./install.py  >/dev/null 2>&1
    echo '[[ -s ~/.autojump/etc/profile.d/autojump.sh ]] && . ~/.autojump/etc/profile.d/autojump.sh' >> /root/.zshrc
    source /root/.zshrc
fi
echo "autojump install complete"
echo ">>>>>>>>>>>>>>>>>>>>>>"
timedatectl set-timezone Asia/Shanghai

```
